# Phase 1 Prompt – Core CLI Skeleton 🏗️

You are **OpenAI Codex** operating as a senior Go release engineer.
Follow *every* instruction below **verbatim** unless it conflicts with legal
or security policy. When conflicts arise, **raise a question** instead of
silently diverging.

---

## 🎯 Objectives

1. **Select the command framework**

   * Evaluate **spf13/cobra** vs **urfave/cli** (speed, maintenance, completions).  
   * **Adopt _spf13/cobra_** and generate boilerplate via `cobra-cli init --pkg github.com/jalsarraf0/ai-chat-cli`.

2. **Implement the root command `ai-chat`**  

   ```bash
   ai-chat help         # auto-generated by cobra
   ai-chat version      # prints semantic version, commit, build-date
   ai-chat ping         # returns 0 and "pong" text
   ```

3. **Stub chat package**

   * Create `pkg/chat/chat.go` with interface:

     ```go
     // Package chat abstracts the LLM backend.
     type Client interface {
         Ping(ctx context.Context) error
         Version(ctx context.Context) (string, error)
     }
     ```

   * Add a `mockClient` for unit tests.

4. **Testing & coverage**

   * Table-driven tests in `cmd/...` and `pkg/chat/...` using `t.Parallel()`.  
   * Target **≥ 83 %** coverage (pipeline gate is 80 %).
   * If you adopt slice testing, merge coverprofiles with `gocovmerge` per add-on doc.

5. **CLI UX polish**

   * `--help` shows global flags `--config`, `--verbose`.  
   * `ai-chat version --short` prints just the semver.  
   * Provide bash/zsh/fish/PowerShell completions via `ai-chat completion`.

6. **Make targets**

   | Target | Description |
   |--------|-------------|
   | `make build` | build `bin/ai-chat` |
   | `make lint`  | run `golangci-lint run ./...` |
   | `make test`  | run race + coverage gate |
   | `make man`   | generate `docs/man/*` via `cobra-cli add man` |

7. **Docs**

   * Update `README.md` quick-start to use the new root command.  
   * Document each sub-command briefly.  

8. **Git workflow**

   * Branch **`phase1/core-cli`**, base **`dev`**.  
   * Single signed commit: **“feat(phase-1): core CLI skeleton”**.  
   * Rebase onto `dev` before pushing; resolve conflicts locally.

---

## ✅ Acceptance Criteria

| Gate | Requirement |
|------|-------------|
| CI   | Lone workflow `ci.yml` passes (coverage-gate → gosec → docs). |
| Coverage | ≥ 83 % (fail the gate if < 83 %). |
| Lint | `golangci-lint run ./...` exits 0. |
| Race | `go test -race ./...` passes. |
| Docs | `make man` & `make docs` produce no git diff noise. |
| UX   | `ai-chat help`, `version`, `ping` behave as spec’d on Linux, macOS, Windows (CI matrix). |
| Merge | PR cleanly rebased onto `dev` – **no `<<<<` markers**. |

---

## 🚦 Ground Rules (verbatim excerpt)

> **Internet is always on.**  
> If a dependency or tool is missing, you **MUST**  
> `go get -u ./... && go mod tidy -e -v` or  
> `go install <module>@latest`.

> **Coverage Gate ≥ 83 %** – the pipeline enforces 80 %; always ship 83 %+.

> **Conflict-Free PRs** – rebase onto `dev`, resolve locally, force-push with-lease.

> **CI / CD Compliance** – *never* add more workflows; modify the existing single
> `ci.yml` only if extending jobs fan-out. Stages order is immutable.

_Check-list before opening a PR_
- [ ] `go vet ./...` clean
- [ ] `go test -race ./...` ≥ 83 %
- [ ] `go mod tidy -e` leaves no changes
- [ ] Docs regenerated
- [ ] Branch rebased – zero conflicts
- [ ] Commit message ≤ 72 chars, imperative

---

## 🛠️ Commands Cheat-Sheet

```bash
# Initialise cobra skeleton
go install github.com/spf13/cobra-cli@latest
cobra-cli init --pkg github.com/jalsarraf0/ai-chat-cli

# Add sub-commands
cobra-cli add ping
cobra-cli add version

# Build + test
make build lint test
```

---

## 🔒 License

MIT © 2025 Jamal Al‑Sarraf
